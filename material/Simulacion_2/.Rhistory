setwd("~/GitHub/Proyecto/material/Simulacion_2")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(car)
library(dplyr)
#setwd("~/Documents/_NotasCiencias/ProyectoVIH/Proyecto06_Simulacion/CCASAnet_Data/mock-ccasanet-data-2017-01-19/")
#dir <- "~/Documents/_NotasCiencias/ProyectoVIH/Proyecto06_Simulacion/CCASAnet_Data/mock-ccasanet-data-2017-01-19/"
setwd("~/GitHub/Proyecto/material/Simulacion_2")
art <- read.csv(paste0(dir,"art_sim.csv"))
library(tidyverse)
library(ggplot2)
library(car)
library(dplyr)
#setwd("~/Documents/_NotasCiencias/ProyectoVIH/Proyecto06_Simulacion/CCASAnet_Data/mock-ccasanet-data-2017-01-19/")
#dir <- "~/Documents/_NotasCiencias/ProyectoVIH/Proyecto06_Simulacion/CCASAnet_Data/mock-ccasanet-data-2017-01-19/"
setwd("~/GitHub/Proyecto/material/Simulacion_2")
dir <- "~/GitHub/Proyecto/material/Simulacion_2"
art <- read.csv(paste0(dir,"art_sim.csv"))
library(tidyverse)
library(ggplot2)
library(car)
library(dplyr)
#setwd("~/Documents/_NotasCiencias/ProyectoVIH/Proyecto06_Simulacion/CCASAnet_Data/mock-ccasanet-data-2017-01-19/")
#dir <- "~/Documents/_NotasCiencias/ProyectoVIH/Proyecto06_Simulacion/CCASAnet_Data/mock-ccasanet-data-2017-01-19/"
setwd("~/GitHub/Proyecto/material/Simulacion_2/")
dir <- "~/GitHub/Proyecto/material/Simulacion_2/"
art <- read.csv(paste0(dir,"art_sim.csv"))
basic <- read.csv(paste0(dir,"basic_sim.csv"))
follow <- read.csv(paste0(dir,"follow_sim.csv"))
lab_cd4 <- read.csv(paste0(dir,"lab_cd4_sim.csv"))
lab_rna <- read.csv(paste0(dir,"lab_rna_sim.csv"))
visit <- read.csv(paste0(dir,"visit_sim.csv"))
## #dim(art); #dim(basic); #dim(follow); #dim(lab_cd4); #dim(lab_rna); #dim(visit)
head(art,3)
head(basic,3)
head(follow,3)
head(lab_cd4,3)
head(lab_rna,3)
head(visit,3)
class(basic$birth_d)
basic$birth_d <- as.Date(basic$birth_d,"%Y-%m-%d")
class(basic$birth_d)
basic$baseline_d <- as.Date(basic$baseline_d,"%Y-%m-%d")
follow$death_d <- as.Date(follow$death_d,"%Y-%m-%d")
follow$l_alive_d <- as.Date(follow$l_alive_d,"%Y-%m-%d")
lab_cd4$cd4_d <- as.Date(lab_cd4$cd4_d,"%Y-%m-%d")
lab_cd4$cd4_v_m227 = ifelse(lab_cd4$cd4_v<227,1,0)
basic$education = sample(c(1,0),size=nrow(basic),replace=TRUE,prob=c(0.15,85)) ### patients (15%) had no education or primary school only
basic$age_M35 = ifelse(basic$age>35,1,0)
datos_bf <- merge(basic,follow, by=c("patient","site"),all=TRUE)
lab_cd4_base <- subset(lab_cd4,lab_cd4$time==0) ### CD4 baseline
datos_bf4 <- merge(datos_bf,lab_cd4_base, by=c("patient","site"), all.x=FALSE,all.y=FALSE,nu.dups=TRUE)
diseases = data.frame(patient=basic$patient, site=basic$site)
diseases$tuberculosis_y = 0
diseases$tuberculosis_d = as.Date(NA)
patients = unique(lab_cd4$patient) ### pacientes con laboratorio CD4
Ntb = n_distinct(patients)
tuberculosis = sample(c(1,0),size=Ntb,replace=TRUE,prob=c(6.8,93.2))
# Ntb_a = n_distinct(follow$patient[follow$death_y==0])
# Ntb_d = n_distinct(follow$patient[follow$death_y==1])
# prob_a = -log(0.932)/log(1.57)
# prob_d = -log(0.068)/log(1.57)
# tb_alive = sample(c(1,0),size=Ntb_a,replace=TRUE,prob=c(6.8,93.2))
# tb_death = sample(c(1,0),size=Ntb_d,replace=TRUE,prob=c(6.8,93.2))
# tuberculosis = sample(c(1,0),size=Ntb,replace=TRUE,prob=c(6.8,93.2))
datos_id
for(i in 1:Ntb){
if(tuberculosis[i]==1){
id = patients[i]
datos_id = subset(lab_cd4,lab_cd4$patient==id)
id.num = which(diseases$patient==as.character(id))
diseases$tuberculosis_y[id.num] = 1
diseases$tuberculosis_d[id.num] = sample(datos_id$cd4_d,size=1)
}
}
head(diseases)
datos_bf4d <- merge(datos_bf4,diseases, by=c("patient","site"), all.x=FALSE,all.y=FALSE,nu.dups=TRUE)
datos_id
library(survival)
datos_bf4d$tiempo = ifelse(datos_bf4d$death_y==1,
as.numeric(difftime(datos_bf4d$death_d,datos_bf4d$birth_d, units="auto"))/365.25,
as.numeric(difftime(datos_bf4d$l_alive_d,datos_bf4d$birth_d, units="auto"))/365.25)
datos_bf4d$muerte = datos_bf4d$death_y
