---
title: "Regresion Logística"
author: "Lizbeth Naranjo Albarrán y Yanink Neried Caro Vega"
date: "26/agosto/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Regresión Logística

- Simular una respuesta de un modelo de regresión logística. 

Se tiene la variable de interés $Y$ binaria (variable respuesta o dependiente), $Y\in\{0,1\}$, y se relaciona con un conjunto de covariables $x_1,\ldots,x_k$, a través de un modelo de regresión logística:
$$ \log\left({p \over 1-p}\right) = \beta_0 + \beta_1x_1 + \beta_2x_2 +\cdots+ \beta_kx_k $$ 
o equivalentemente
$$ p = {\exp\left(\beta_0 + \beta_1x_1 + \beta_2x_2 +\cdots+ \beta_kx_k\right) \over {1+ \exp\left(\beta_0 + \beta_1x_1 + \beta_2x_2 +\cdots+ \beta_kx_k\right)}} $$ 
que es igual a la función de distribución acumulada (fda) de una distribución logística. 

Si $X\sim Logistica(0,1)$ su fda es:
$F_X(x) = {\exp(x) \over {1+ \exp(x)}} = {1 \over {1+ \exp(-x)}}.$

\ 

## Regresión logística usando coeficientes para la probabilidad de éxito


```{r, warning=FALSE,message=FALSE, fig.show = "hold", out.width = "50%"} 
n = 300   ### numero de sujetos 
K = 3   ### numero parametros de regresion
betas = as.vector(c(3,-2,0.5,+1))   ### coeficientes de regresion 
set.seed(12345)
x1 = runif(n)   ### covariable x1
x2 = rnorm(n,0,1)   ### covariable x2
x3 = factor(rep(c("A","B","C"),n/3))   ### variable categorica con categorias A, B, C
dummyB = ifelse(x3==levels(x3)[2],1,0)
dummyC = ifelse(x3==levels(x3)[3],1,0)
#eta = betas[2] + betas[1]*x1 ###+ betas[3]*dummyB+ betas[4]*dummyC 
eta = 2 - 5*x1 + 0.5*dummyB - 1*dummyC ###+ betas[2]*x2 ###combinacion lineal
p = plogis(eta)   ### se calcula p=P[Y=1] ### fda logistica
p1 = exp(eta)/(1+exp(eta))
u = runif(n)
y = ifelse(p>u,1,0)   ### simular la variable respuesta Y de manera aleatoria
head(cbind(y,x1,x2,x3,eta,p,u),4)
pairs(cbind(y,x1,x2,x3))
plot(eta,y,col=x3)
points(eta,p,col="blue",pch=19)
plot(x1,y,col=x3)
points(x1,p,col=x3,pch=19)
modelo <- glm(y ~ x1 + x2 + factor(x3), family=binomial(link="logit"))   ### estimar parametros
summary(modelo)
```

```{r, warning=FALSE,message=FALSE, fig.show = "hold", out.width = "50%"} 
library(AUC)
pred <- predict(modelo)   ### Predecir P[Y=1]
Ypred <- ifelse(pred>0.5,1,0)   ### Predecir Y, considerando como punto de corte 0.5
table(y,Ypred)   ### Tabla de observaciones vs. predicciones
sens <- sensitivity(pred,factor(y))   ### Calcula la sensibilidad
head(sens$cutoffs)   ### puntos de corte para calcular la sensibilidad
head(sens$measure)   ### valores de la sensibilidad
spec <- specificity(pred,factor(y))   ### Calcula la especificidad
head(spec$cutoffs)   ### puntos de corte para calcular la especificidad
head(spec$measure)   ### valores de la especificidad
plot(roc(pred,factor(y)),main="Curva ROC")
auc(roc(pred,factor(y)))   ### Area bajo la curva ROC
```
